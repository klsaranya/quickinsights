<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel = "import" href="../elements/drag-scaling.html">
<link rel = "import" href="../elements/buttons-multi.html">
<link rel = "import" href="../elements/buttons-single.html">
<link rel = "import" href="../elements/star-rate.html">
<link rel = "import" href="../elements/yes-no.html">
<link rel = "import" href="../elements/number-scaling.html">
<link rel = "import" href="../elements/image-grid.html">
<link rel = "import" href="../elements/yes-noother.html">
<link rel = "import" href="../elements/image-multi.html">
<link rel = "import" href="../elements/some-toolbar.html">
<link rel = "import" href="../elements/submit-page.html">

<polymer-element name="qi-app" attributes="quesid">
	<template>
		<style>
			:host{
				background: url(imgs/bg1.jpg);
				font-family: 'roboto';
				font-weight: 300;
				
			}
			.et-page { 	
				width: 100%;
				height: 700px;
				margin: 0px;
			}
			.quescard{
				background: rgba(0,0,0,0.4);
				color: white;
				padding: 3%;
				margin: 40px 0px 5px 0px;
				width: 100%;
				box-sizing: border-box;

			}
			.theme-box{
				position: absolute;
				right: 0;
				top: 0;
				/*margin: 0px 0px 5px 5px;*/
			}
			
			.container{
				max-width: 450px;
				margin: 0;
				height: 100%;
				width: inherit;
				box-sizing: border-box;

			}
			.whole{
				width: 100%;
				height: 100%;
			}
			.card {
				width: 
			}
			core-animated-pages {
				height: 100%;
			}
			#image {
				height: 450px;
			}
		</style>
		
	<core-toolbar>
		<div vertical layout center around-justified>Quick Insights</div>
	</core-toolbar> 
	  <core-animated-pages id="ani" on-clicked-next="{{next}}" on-clicked-back="{{back}}" on-done-event="{{multi}}" on-clicked-submit="{{save}}" transitions="slide-from-right">
		<template repeat="{{data2, i in data}}">
			<section layout vertical center class="theme-box">

				<template if="{{data2.ques_type == 'yes-no' }}">
				    <div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<yes-no layout vertical content="{{data2}}"> </yes-no>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

			    <template if="{{data2.ques_type == 'drag-scaling' }}">
				    <div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<drag-scaling layout vertical content="{{data2}}"> </drag-scaling>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

				<template if="{{ data2.ques_type == 'buttons-multi' }}">
					<div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<buttons-multi layout vertical content="{{data2}}" id="storage"> </buttons-multi>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

			    <template if="{{ data2.ques_type == 'star-rate' }}">
					<div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<star-rate layout vertical content="{{data2}}"> </star-rate>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

			    <template if="{{ data2.ques_type == 'buttons-single' }}">
					<div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<buttons-single layout vertical content="{{data2}}"> </buttons-single>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

			    <template if="{{ data2.ques_type == 'image-grid' }}">
					<div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<image-grid layout vertical content="{{data2}}" id="image"> </image-grid>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

			    <template if="{{ data2.ques_type == 'image-multi' }}">
					<div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<image-multi layout vertical content="{{data2}}" id="image"> </image-multi>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

			    <template if="{{ data2.ques_type == 'number-scaling' }}">
					<div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<number-scaling layout vertical content="{{data2}}" id="storage"> </number-scaling>
						</paper-shadow>

						<some-toolbar totalscreens="8"></some-toolbar>	
					</div>
			    </template>

			    <template if="{{ data2.ques_type == 'submit' }}">
					<div class="container" vertical layout center center-justified>
						<paper-shadow z="1" class="quescard">
							<submit-page layout vertical content="{{response}}" id="storage"> </submit-page>
						</paper-shadow>
					</div>
			    </template>
			</section>
		</template>
	</core-animated-pages>
	   
	</template>

  	<script>
  	Parse.initialize("df5aOQc2My8UzHgWQOCbI5JO0g8ZKpjDQofQAe31", "4ndVE9l8oS9aUUgZinfJL81hmgtzkhCEM7DGXYfn");
  			

	  Polymer('qi-app', {
	  	up: true,
	    max: 0,
	    ans: "",
	    index: 0,
	   	response: [],
	   	obj: {},
	  //   
	  data : [],
	  	next: function(e,d,t) {
	  		index = t.selected;
	  		ans = d.answer;
	  		if(ans)
	  			this.obj[index] = ans;
	  		console.log(this.obj[index]);
	      	console.log("Pura response: ");
	      	console.log(this.obj);
	      	console.log('---------------');
	  		up=true;

		    if (t.selected === this.max) 
		      t.selected -= 1;
		      
		    else
		      t.selected += 1;
	      	
	  	},
	  	ready: function(){
	  		console.log("ready");
	  		var Question = Parse.Object.extend("Question");
	  		var query = new Parse.Query(Question);
	  		console.log(this.quesid);
	  		var that = this;
	  		query.equalTo("surveyId",this.quesid);
	  		query.first({
	  			success: function(obj) {
	  				console.log(obj);
	  				that.data = obj.get('data');
	  				that.max = that.data.length;
	  				console.log(that.max);
	  			}
	  		})


	  	},
	  	back: function(e,d,t) {

	  		up=false;

	  		if(t.selected === 0)
	  			t.selected += 1;
	  		else
	  			t.selected -= 1;
	  	},
	  	multi: function(e,d,t) {
	  		index = t.selected;
	  		ans = d.answer;
	  		this.obj[index] = ans;
	  	},
	  	s4: function() {
	  		return Math.floor((1 + Math.random()) * 0x10000)
			      .toString(16)
			      .substring(1);
	  	},
	  	randomgen: function() {
		  	return this.s4() + this.s4() + '-' + this.s4() + '-' + this.s4();
	  	},
	  	save: function(e,d,t) {
	  		var str = this.randomgen();
	  		console.log(str);
	  		var Responses = Parse.Object.extend("Responses");
	  		var Responses = new Responses();
	  		var that = this;

	  		Responses.set("surveyId", this.quesid);
	  		Responses.set("answer", that.obj);
	  		Responses.set("sessionid", str);

	  		Responses.save(null, {

	  			success: function(Responses) {
	  				alert('Your response have just been saved successfully. Thank you for your time.');
	  			},
	  			error: function(Responses, error) {

				    alert('Failed to create new object, with error code: ' + error.message);
				}

	  		});
	  	
	  	}

	  });
	 
  	</script>
</polymer-element>